<!DOCTYPE html>
<html>

<head>
  <!-- The '/homey.js' script must be included in your settings view to work -->
  <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      margin-left: 10px;
      margin-right: 10px;
    }

    .footer {
      text-align: center;
      margin-left: 10px;
      margin-right: 10px;
      margin-top: auto;
    }

    .homey-button-primary-full {
      margin-top: auto;
      align-self: center;
      margin-bottom: 10px;
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="content">
    <header class="homey-header">
      <p class="homey-subtitle" data-i18n="settings.subtitle"></p>
    </header>

    <fieldset class="homey-form-fieldset">

      <div class="homey-form-group">
        <label class="homey-form-label" for="apiKey" data-i18n="settings.api.label"></label>
        <input class="homey-form-input" id="apiKey" type="text" />
      </div>
    </fieldset>
  </div>

  <div class="footer">
    <button id="save" class="homey-button-primary-full" data-i18n="settings.button"></button>
  </div>

  <script type="text/javascript">
    // a method named 'onHomeyReady' must be present in your code
    function onHomeyReady(Homey) {
      // Tell Homey we're ready to be displayed
      Homey.ready();
  
      var apiKeyElement = document.getElementById("apiKey");
      apiKeyElement.placeholder = Homey.__("settings.api.placeholder");

      var saveElement = document.getElementById("save");

      // Load the saved API Key from Homey settings
      Homey.get("gemini_api_key", function (err, apiKey) {
        if (err) return console.error("Error loading API Key:", err);
        if (apiKey) {
          apiKeyElement.value = apiKey;
        }
      });

      saveElement.addEventListener("click", function (e) {
        var apiKey = apiKeyElement.value.trim();

        if (!apiKey) {
          Homey.alert(Homey.__("settings.error.api"));
          return;
        }

        // Save the API Key to Homey settings
        Homey.set("gemini_api_key", apiKey, function (err) {
          if (err) return Homey.alert(Homey.__("settings.error.generic") + ": " + err);
          Homey.alert(Homey.__("settings.saved"));
        });
      });
    }
  </script>
</body>

</html>